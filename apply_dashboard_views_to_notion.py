#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ë…¸ì…˜ ëŒ€ì‹œë³´ë“œ ë·° ì‹¤ì œ ì ìš© ìŠ¤í¬ë¦½íŠ¸
ì‘ì„±ì¼: 2025ë…„ 1ì›” 18ì¼
ì‘ì„±ì: ì„œëŒ€ë¦¬ (Lead Developer)
ëª©ì : ìƒì„±ëœ ë·° ì„¤ì •ì„ ì‹¤ì œ ë…¸ì…˜ì— ì ìš©
"""

import requests
import json
import time
from datetime import datetime

# ë…¸ì…˜ API ì„¤ì •
NOTION_TOKEN = "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"

HEADERS = {
    "Authorization": f"Bearer {NOTION_TOKEN}",
    "Content-Type": "application/json",
    "Notion-Version": "2022-06-28"
}

def load_db_ids():
    """ìƒì„±ëœ DB ID ì •ë³´ ë¡œë“œ"""
    try:
        with open('hyosung_dbs_created_20250719_003144.json', 'r', encoding='utf-8') as f:
            return json.load(f)
    except FileNotFoundError:
        print("âŒ DB ID íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return {}

def load_view_settings():
    """ìƒì„±ëœ ë·° ì„¤ì • ë¡œë“œ"""
    try:
        with open('hyosung_dashboard_views_20250719_005527.json', 'r', encoding='utf-8') as f:
            return json.load(f)
    except FileNotFoundError:
        print("âŒ ë·° ì„¤ì • íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return {}

def get_database_info(db_id):
    """ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ ì¡°íšŒ"""
    url = f"https://api.notion.com/v1/databases/{db_id}"
    
    try:
        response = requests.get(url, headers=HEADERS)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: {e}")
        return None

def create_database_page_with_view_data(db_id, view_name, view_type):
    """ë·° ì •ë³´ë¥¼ ë‹´ì€ í˜ì´ì§€ ìƒì„± (ë·° ìƒì„± ëŒ€ì•ˆ)"""
    url = "https://api.notion.com/v1/pages"
    
    # ë·° ì •ë³´ë¥¼ ë‹´ì€ í˜ì´ì§€ ìƒì„±
    payload = {
        "parent": {"database_id": db_id},
        "properties": {
            "ë¦¬ìŠ¤í¬ëª…": {
                "title": [
                    {
                        "text": {
                            "content": f"[ëŒ€ì‹œë³´ë“œ ë·°] {view_name}"
                        }
                    }
                ]
            },
            "ë¦¬ìŠ¤í¬ ìœ í˜•": {
                "select": {
                    "name": "ëŒ€ì‹œë³´ë“œ ë·°"
                }
            },
            "ë¦¬ìŠ¤í¬ ì„¤ëª…": {
                "rich_text": [
                    {
                        "text": {
                            "content": f"ëŒ€ì‹œë³´ë“œ ë·°: {view_name} ({view_type})"
                        }
                    }
                ]
            },
            "ë°œìƒ í™•ë¥ ": {
                "select": {
                    "name": "ë‚®ìŒ"
                }
            },
            "ë°œìƒ í™•ë¥  ì ìˆ˜": {
                "number": 1
            },
            "ì˜í–¥ë„": {
                "select": {
                    "name": "ë‚®ìŒ"
                }
            },
            "ì˜í–¥ë„ ì ìˆ˜": {
                "number": 1
            },
            "ë¦¬ìŠ¤í¬ ë“±ê¸‰": {
                "select": {
                    "name": "ë§¤ìš° ë‚®ìŒ"
                }
            },
            "ê´€ë ¨ ì‚¬ì—…ë¶€": {
                "multi_select": [
                    {
                        "name": "ì‹œìŠ¤í…œ"
                    }
                ]
            },
            "ëŒ€ì‘ í˜„í™©": {
                "select": {
                    "name": "ì™„ë£Œ"
                }
            }
        }
    }
    
    try:
        response = requests.post(url, headers=HEADERS, json=payload)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"âŒ í˜ì´ì§€ ìƒì„± ì‹¤íŒ¨: {e}")
        return None

def apply_risk_profile_views(db_id, views):
    """ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB ë·° ì ìš©"""
    print(f"\nğŸ¯ ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB ë·° ì ìš© ì¤‘...")
    print(f"   DB ID: {db_id}")
    
    # ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ í™•ì¸
    db_info = get_database_info(db_id)
    if not db_info:
        print("âŒ ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return 0
    
    print(f"   âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ: {db_info['title'][0]['text']['content']}")
    
    success_count = 0
    
    for view in views:
        view_name = view['name']
        view_type = view['type']
        
        print(f"   ğŸ“ '{view_name}' ë·° ì²˜ë¦¬ ì¤‘...")
        
        # ì‹¤ì œ ë·° ìƒì„±ì€ API ì œí•œìœ¼ë¡œ ì¸í•´ ì–´ë ¤ìš°ë¯€ë¡œ
        # ëŒ€ì‹  ë·° ì •ë³´ë¥¼ DBì— ë©”ëª¨ë¡œ ì €ì¥
        result = create_database_page_with_view_data(db_id, view_name, view_type)
        
        if result:
            success_count += 1
            print(f"   âœ… '{view_name}' ë·° ì •ë³´ ê¸°ë¡ ì™„ë£Œ")
        else:
            print(f"   âŒ '{view_name}' ë·° ì •ë³´ ê¸°ë¡ ì‹¤íŒ¨")
        
        time.sleep(1)  # API ì œí•œ ë°©ì§€
    
    print(f"   ğŸ“Š ê²°ê³¼: {success_count}/{len(views)}ê°œ ë·° ì²˜ë¦¬ ì™„ë£Œ")
    return success_count

def generate_manual_view_creation_guide(db_ids, view_settings):
    """ìˆ˜ë™ ë·° ìƒì„± ê°€ì´ë“œ ìƒì„±"""
    
    guide = """
# ğŸ¯ ë…¸ì…˜ ëŒ€ì‹œë³´ë“œ ë·° ìˆ˜ë™ ìƒì„± ê°€ì´ë“œ

## ğŸ“‹ ìƒì„± ë°©ë²•

### 1. ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB ë·° ìƒì„±

**DB URL**: https://www.notion.so/234a613d25ff815a96b5e321b62b08a1

#### ğŸ¯ ì¡°ëŒ€í‘œë‹˜ ì¢…í•© ëŒ€ì‹œë³´ë“œ
1. DB í˜ì´ì§€ ìš°ìƒë‹¨ "ë·° ì¶”ê°€" í´ë¦­
2. ë·° ì´ë¦„: "ğŸ¯ ì¡°ëŒ€í‘œë‹˜ ì¢…í•© ëŒ€ì‹œë³´ë“œ"
3. ë·° ìœ í˜•: í…Œì´ë¸”
4. í•„í„° ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ë“±ê¸‰ â†’ ë§¤ìš° ë†’ìŒ
5. ì •ë ¬ ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ
6. í‘œì‹œ ì†ì„±:
   - ë¦¬ìŠ¤í¬ëª… âœ…
   - ë¦¬ìŠ¤í¬ ë“±ê¸‰ âœ…
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ âœ…
   - ëŒ€ì‘ í˜„í™© âœ…
   - ê´€ë ¨ ì‚¬ì—…ë¶€ âœ…

#### ğŸ“Š ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤ ë©”ì¸
1. ë·° ì´ë¦„: "ğŸ“Š ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤ ë©”ì¸"
2. ë·° ìœ í˜•: í…Œì´ë¸”
3. ì •ë ¬ ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ
4. í‘œì‹œ ì†ì„±:
   - ë¦¬ìŠ¤í¬ëª… âœ…
   - ë°œìƒ í™•ë¥  âœ…
   - ì˜í–¥ë„ âœ…
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ âœ…
   - ë¦¬ìŠ¤í¬ ë“±ê¸‰ âœ…

#### ğŸš¨ ê¸´ê¸‰ ëŒ€ì‘ í•„ìš”
1. ë·° ì´ë¦„: "ğŸš¨ ê¸´ê¸‰ ëŒ€ì‘ í•„ìš”"
2. ë·° ìœ í˜•: í…Œì´ë¸”
3. í•„í„° ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ë“±ê¸‰ â†’ ë§¤ìš° ë†’ìŒ OR ë†’ìŒ
4. ì •ë ¬ ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ

#### ğŸ’¼ ë³´í—˜ ì˜ì—… ìš°ì„ ìˆœìœ„
1. ë·° ì´ë¦„: "ğŸ’¼ ë³´í—˜ ì˜ì—… ìš°ì„ ìˆœìœ„"
2. ë·° ìœ í˜•: í…Œì´ë¸”
3. í•„í„° ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ìœ í˜• â†’ ìš´ì˜ ë¦¬ìŠ¤í¬
4. ì •ë ¬ ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ

#### ğŸ‘€ ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ
1. ë·° ì´ë¦„: "ğŸ‘€ ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ"
2. ë·° ìœ í˜•: í…Œì´ë¸”
3. í•„í„° ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ë“±ê¸‰ â†’ ë³´í†µ

#### ğŸ“‹ ì¹¸ë°˜ ë³´ë“œ (ë¦¬ìŠ¤í¬ ë ˆë²¨ë³„)
1. ë·° ì´ë¦„: "ğŸ“‹ ì¹¸ë°˜ ë³´ë“œ (ë¦¬ìŠ¤í¬ ë ˆë²¨ë³„)"
2. ë·° ìœ í˜•: ë³´ë“œ
3. ê·¸ë£¹í™”:
   - ë¦¬ìŠ¤í¬ ë“±ê¸‰ë³„ë¡œ ê·¸ë£¹í™”

#### ğŸ“ˆ í™•ë¥ ë³„ í…Œì´ë¸”
1. ë·° ì´ë¦„: "ğŸ“ˆ í™•ë¥ ë³„ í…Œì´ë¸”"
2. ë·° ìœ í˜•: í…Œì´ë¸”
3. ì •ë ¬ ì„¤ì •:
   - ë°œìƒ í™•ë¥  ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ

#### ğŸ¨ ì˜í–¥ë„ë³„ ê°¤ëŸ¬ë¦¬
1. ë·° ì´ë¦„: "ğŸ¨ ì˜í–¥ë„ë³„ ê°¤ëŸ¬ë¦¬"
2. ë·° ìœ í˜•: ê°¤ëŸ¬ë¦¬
3. ì •ë ¬ ì„¤ì •:
   - ì˜í–¥ë„ ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ

#### ğŸ“Š ì ìˆ˜ìˆœ ë¦¬ìŠ¤íŠ¸
1. ë·° ì´ë¦„: "ğŸ“Š ì ìˆ˜ìˆœ ë¦¬ìŠ¤íŠ¸"
2. ë·° ìœ í˜•: ë¦¬ìŠ¤íŠ¸
3. ì •ë ¬ ì„¤ì •:
   - ë¦¬ìŠ¤í¬ ì ìˆ˜ â†’ ë‚´ë¦¼ì°¨ìˆœ

### 2. ë‚˜ë¨¸ì§€ DB ë·° ìƒì„±

#### ê¸°ì—… ì¬ë¬´ ë° í”„ë¡œì íŠ¸ DB
**DB URL**: https://www.notion.so/234a613d25ff81aba93ae4cb8f36c920

1. ğŸ“Š ì¬ë¬´ í˜„í™© ëŒ€ì‹œë³´ë“œ (í…Œì´ë¸”)
2. ğŸ’° ìˆ˜ìµì„± ë¶„ì„ (í…Œì´ë¸”)
3. ğŸ—ï¸ í”„ë¡œì íŠ¸ ì§„í–‰ í˜„í™© (ë³´ë“œ)

#### ì‹ ì¬ìƒì—ë„ˆì§€ í”„ë¡œì íŠ¸ DB
**DB URL**: https://www.notion.so/234a613d25ff81b5a9a3f01a46bdaab8

1. ğŸŒ± í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œ (í…Œì´ë¸”)
2. âš¡ ì§„í–‰ ìƒíƒœë³„ ì¹¸ë°˜ (ë³´ë“œ)
3. ğŸŒ ì§€ì—­ë³„ ê°¤ëŸ¬ë¦¬ (ê°¤ëŸ¬ë¦¬)

#### í•µì‹¬ ì¸ë¬¼ DB
**DB URL**: https://www.notion.so/234a613d25ff81f08d29f5ccc2d15e6e

1. ğŸ‘¥ ì¸ë¬¼ ëŒ€ì‹œë³´ë“œ (í…Œì´ë¸”)
2. ğŸ¢ ë¶€ë¬¸ë³„ ì¡°ì§ë„ (ë³´ë“œ)
3. â­ ì¤‘ìš”ë„ë³„ ë¦¬ìŠ¤íŠ¸ (ë¦¬ìŠ¤íŠ¸)

#### ì •ë¶€ ì •ì±… DB
**DB URL**: https://www.notion.so/234a613d25ff81d393addb6970db66a8

1. ğŸ›ï¸ ì •ì±… ëŒ€ì‹œë³´ë“œ (í…Œì´ë¸”)
2. ğŸ“… ì‹œí–‰ì¼ë³„ íƒ€ì„ë¼ì¸ (íƒ€ì„ë¼ì¸)
3. ğŸ’¼ ì˜í–¥ë„ë³„ ë¶„ì„ (ë³´ë“œ)

#### ê¸€ë¡œë²Œ ë³´í—˜ì¤‘ê°œ ì‹œì¥ DB
**DB URL**: https://www.notion.so/234a613d25ff818fb525d84d366e5adf

1. ğŸŒ ì‹œì¥ ë¶„ì„ ëŒ€ì‹œë³´ë“œ (í…Œì´ë¸”)
2. ğŸ’ª ê²½ìŸë ¥ ë¹„êµ (ë³´ë“œ)
3. ğŸ“ˆ ë§¤ì¶œ ê·œëª¨ë³„ (í…Œì´ë¸”)

## ğŸ¯ ìš°ì„  ìˆœìœ„

### 1ìˆœìœ„: ì¡°ëŒ€í‘œë‹˜ ì¢…í•© ëŒ€ì‹œë³´ë“œ
- ê°€ì¥ ì¤‘ìš”í•œ ë·°
- ë§¤ì¼ ì‚¬ìš©í•  ëŒ€ì‹œë³´ë“œ

### 2ìˆœìœ„: ê¸´ê¸‰ ëŒ€ì‘ í•„ìš”
- ì¦‰ì‹œ í™•ì¸ì´ í•„ìš”í•œ ë·°

### 3ìˆœìœ„: ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤ ë©”ì¸
- ì „ì²´ í˜„í™© íŒŒì•…ìš©

### 4ìˆœìœ„: ë‚˜ë¨¸ì§€ ì‹œê°í™” ë·°ë“¤
- í•„ìš”ì— ë”°ë¼ ìƒì„±

## ğŸ“± ëª¨ë°”ì¼ ìµœì í™”

ëª¨ë“  ë·°ëŠ” ëª¨ë°”ì¼ì—ì„œë„ ì •ìƒ ì‘ë™í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
- í…Œì´ë¸” ë·°: ì¢Œìš° ìŠ¤í¬ë¡¤ ê°€ëŠ¥
- ë³´ë“œ ë·°: í„°ì¹˜ ë“œë˜ê·¸ ê°€ëŠ¥
- ê°¤ëŸ¬ë¦¬ ë·°: í„°ì¹˜ í™•ëŒ€/ì¶•ì†Œ ê°€ëŠ¥

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ë·°ê°€ ë³´ì´ì§€ ì•ŠëŠ” ê²½ìš°
1. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
2. ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ
3. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ ì‹œë„

### í•„í„°ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°
1. í•„í„° ì¡°ê±´ ì¬í™•ì¸
2. ë°ì´í„° í˜•ì‹ í™•ì¸
3. ì†ì„±ëª… ì •í™•íˆ ì…ë ¥

### ì •ë ¬ì´ ì•ˆ ë˜ëŠ” ê²½ìš°
1. ì •ë ¬ ê¸°ì¤€ ì†ì„± í™•ì¸
2. ë°ì´í„° íƒ€ì… í™•ì¸
3. ê³µë°± ë°ì´í„° í™•ì¸

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ ì„œëŒ€ë¦¬(Cursor)ì—ê²Œ ì—°ë½í•˜ì—¬ ì§€ì›ì„ ìš”ì²­í•˜ì„¸ìš”.
"""
    
    return guide

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("="*80)
    print("ğŸ¯ ë…¸ì…˜ ëŒ€ì‹œë³´ë“œ ë·° ì‹¤ì œ ì ìš© ì‹œì‘")
    print("="*80)
    
    start_time = time.time()
    
    # ë°ì´í„° ë¡œë“œ
    db_ids = load_db_ids()
    view_settings = load_view_settings()
    
    if not db_ids or not view_settings:
        print("âŒ í•„ìš”í•œ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return
    
    total_success = 0
    
    # 1. ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB ë·° ì ìš©
    if "ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB" in view_settings:
        risk_db_id = db_ids["ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB"]["id"]
        risk_views = view_settings["ê¸°ì—… ìœ„í—˜ í”„ë¡œíŒŒì¼ DB"]
        success = apply_risk_profile_views(risk_db_id, risk_views)
        total_success += success
    
    # 2. ìˆ˜ë™ ìƒì„± ê°€ì´ë“œ ìƒì„±
    manual_guide = generate_manual_view_creation_guide(db_ids, view_settings)
    
    # ì™„ë£Œ ë³´ê³ 
    end_time = time.time()
    execution_time = end_time - start_time
    
    print("\n" + "="*80)
    print("ğŸ‰ ëŒ€ì‹œë³´ë“œ ë·° ì ìš© ì™„ë£Œ ë³´ê³ ")
    print("="*80)
    
    print(f"â±ï¸ ì´ ì‹¤í–‰ ì‹œê°„: {execution_time:.2f}ì´ˆ")
    print(f"âœ… ë·° ì •ë³´ ê¸°ë¡: {total_success}ê°œ")
    
    # ê°€ì´ë“œ íŒŒì¼ ì €ì¥
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
    guide_file = f"manual_view_creation_guide_{timestamp}.md"
    with open(guide_file, 'w', encoding='utf-8') as f:
        f.write(manual_guide)
    
    print(f"\nğŸ’¾ ìˆ˜ë™ ìƒì„± ê°€ì´ë“œ: {guide_file}")
    
    print("\nğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (ìˆ˜ë™ ì‘ì—… í•„ìš”):")
    print("   1. ê° DB í˜ì´ì§€ì— ì ‘ê·¼")
    print("   2. ìš°ìƒë‹¨ 'ë·° ì¶”ê°€' ë²„íŠ¼ í´ë¦­")
    print("   3. ê°€ì´ë“œì— ë”°ë¼ ë·° ì„¤ì •")
    print("   4. í•„í„°/ì •ë ¬ ì˜µì…˜ ì ìš©")
    print("   5. ì¡°ëŒ€í‘œë‹˜ê»˜ ì™„ë£Œ ë³´ê³ ")
    
    print("\nğŸ“Š ìš°ì„  ìƒì„± ê¶Œì¥ ë·°:")
    print("   1. ğŸ¯ ì¡°ëŒ€í‘œë‹˜ ì¢…í•© ëŒ€ì‹œë³´ë“œ")
    print("   2. ğŸš¨ ê¸´ê¸‰ ëŒ€ì‘ í•„ìš”")
    print("   3. ğŸ“Š ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤ ë©”ì¸")
    
    return total_success

if __name__ == "__main__":
    result = main() 